var headline_envy_admin=headline_envy_admin||{};!function(a,b){"use strict";b.set_featured_image=wp.media.featuredImage.set,b.event=b.event||{},b.init=function(){this.init_titles(),this.init_images(),a(document).on("click","#save-post, #wp-preview, #post-preview, #publish",function(c){b.edited_titles&&a("body").addClass("saving-post")}),this.load_title_experiments(),this.load_image_experiments();var c=a("<input>",{name:"headline_envy_loaded",type:"hidden",value:"true"});this.$title_container.after(c)},b.init_titles=function(){this.edited_titles=!1,this.experiment_titles=this.experiment_titles||[],this.$title_container=a(document.getElementById("he-titles")),this.$add_button=this.$title_container.find(".add-title"),this.title_template=a(document.getElementById("he-title-template")).html(),a(document).on("click","#he-titles .add-title",function(){b.add_title(),this.edited_titles=!0}),a(document).on("click","#he-titles .dashicons-dismiss",function(c){c.preventDefault(),b.remove_title(a(this).closest(".he-title"),!0),this.edited_titles=!0}),a(document).on("click","#he-titles .select-title",function(){var b=a(this).closest(".he-container");b.addClass("title-select")}),a(document).on("click","#he-titles .cancel-select-title",function(){var b=a(this).closest(".he-container");b.removeClass("title-select"),b.find('[name="he-winner"]:checked').prop("checked",!1)}),a(document).on("keydown",'#he-titles input[type="text"]',function(a){b.edited_titles=!0}),a(document).on("change",".experiment-options select",function(b){var c=a(this),d=c.val(),e=c.closest(".headline-results").find(".experiment-results");e.find("table").hide(),e.find('table[data-goal="'+d+'"]').css("display","table")})},b.init_images=function(){"1"===this.test_images&&(this.experiment_images=this.experiment_images||[],this.current_images={},this.file_frame=wp.media.frames.file_frame,this.$thumbnail_container=a(document.getElementById("postimagediv")),this.image_template=a(document.getElementById("he-image-template")).html(),this.$thumbnail_container.append(a(document.getElementById("he-image-ui")).html()),this.$image_ui=this.$thumbnail_container.find(".he-image-ui"),a(document).on("featured_image_set",function(a){b.$image_ui.addClass("active")}),a(document).on("click","#remove-post-thumbnail",function(a){b.$image_ui.removeClass("active")}),a(document).on("click",".he-image-ui .dashicons-dismiss",function(c){c.preventDefault(),b.remove_image(a(this).closest(".he-image"),!0),b.edited_titles=!0}),a(document).on("click","#postimagediv .select-image",function(){var b=a(this).closest(".he-container");b.addClass("image-select")}),a(document).on("click","#postimagediv .cancel-select-image",function(){var b=a(this).closest(".he-container");b.removeClass("image-select"),b.find('[name="he-image-winner"]:checked').prop("checked",!1)}),a(document).on("click",".he-container .add-image",function(a){a.preventDefault(),b.file_frame=wp.media({title:b.alternate_image_select_title,button:{text:b.alternate_image_select_button},library:{type:"image"}}),b.file_frame.on("toolbar:create:select",function(){b.file_frame.state().set("filterable","uploaded")}),b.file_frame.on("select",function(){var a=b.file_frame.state().get("selection").first().toJSON();if("undefined"!=typeof b.current_images[a.id]||a.id===Number(b.thumbnail_id))return void alert(b.image_already_used);var c=256/a.width,d={attachment:{url:a.url,width:256,height:a.height*c,title:a.title},value:a.id};b.add_image(d)}),b.file_frame.open()}))},b.add_title=function(b){b=b||{};var c=a(this.title_template),d=this.$title_container.find(".he-title");b.num=b.num||d.length+1,b.id=b.id||"he-title-"+b.num,b.improvement=b.improvement||"0%",b.conversion_rate=b.conversion_rate||"0%",c.attr("data-variation",b.variation||"").attr("data-winner",b.winner||"false"),c.find('input[type="text"]').attr("id",b.id).attr("name","headline_envy_title["+b.num+"]").val(b.value||""),c.find('input[type="radio"]').val(b.variation||""),c.find("label").attr("for",b.id),c.find(".he-status").attr("title",b.improvement+" Improvement, "+b.conversion_rate+" Conversion rate").text(b.improvement),this.$add_button.before(c),a(document).trigger("headline-envy-add-title")},b.add_image=function(b){b=b||{};var c=a(this.image_template),d=this.$thumbnail_container.find(".he-image");b.num=b.num||d.length+1,b.id=b.id||"he-image-"+b.num,b.improvement=b.improvement||"0%",b.conversion_rate=b.conversion_rate||"0%",c.attr("data-variation",b.variation||"").attr("data-winner",b.winner||"false"),c.find('input[type="hidden"]').attr("id",b.id).attr("name","headline_envy_image["+b.num+"]").val(b.value||""),c.find('input[type="radio"]').val(b.variation||""),c.find("label").attr("for",b.id),c.find(".he-status").attr("title",b.improvement+" Improvement, "+b.conversion_rate+" Conversion rate").text(b.improvement),c.find("img").attr("src",b.attachment.url).attr("width",b.attachment.width).attr("height",b.attachment.height).attr("alt",b.attachment.title),this.current_images[b.value]=!0,this.$thumbnail_container.find(".he-image:last").after(c),a(document).trigger("headline-envy-add-image")},b.remove_title=function(c,d){var e=a.trim(c.find("input").val()),f=a.trim(c.find('input[type="text"]').val()),g=!0;e&&d&&(g=confirm(b.title_remove_confirm+' "'+f+'"?')),g&&(c.remove(),a(document).trigger("headline-envy-remove-title"))},b.remove_image=function(c,d){var e=a.trim(c.find('input[type="hidden"]').val()),f=a.trim(c.find("img").attr("alt")),g=!0;e&&d&&(g=confirm(b.image_remove_confirm+' "'+f+'"?')),g&&(c.remove(),a(document).trigger("headline-envy-remove-image"))},b.load_title_experiments=function(){for(var a in this.experiment_titles)this.add_title(this.experiment_titles[a])},b.load_image_experiments=function(){if("1"===this.test_images)for(var a in this.experiment_images)b.add_image(this.experiment_images[a])},wp.media.featuredImage.set=function(c){return"undefined"!=typeof b.current_images[c]?void alert(b.image_already_used):(b.thumbnail_id=c,b.set_featured_image(c),void a(document).trigger({type:"featured_image_set",attachment_id:c}))},a(function(){b.init()})}(jQuery,headline_envy_admin);